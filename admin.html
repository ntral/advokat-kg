<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å ‚Äî –ê–¥–≤–æ–∫–∞—Ç –ö–†</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,-apple-system,sans-serif;background:#0a0e27;color:#e2e8f0;padding:20px}
.container{max-width:1000px;margin:0 auto}
.header{background:#1a1f3a;padding:20px;border-radius:12px;margin-bottom:24px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
.header h1{color:#f59e0b;font-size:1.5rem}
.btn{padding:10px 20px;background:#3b82f6;border:none;border-radius:8px;color:white;font-weight:600;cursor:pointer;font-size:0.9rem;transition:all 0.2s}
.btn:hover{background:#2563eb}
.btn:active{transform:scale(0.95)}
.btn:disabled{opacity:0.5;cursor:not-allowed}
.btn-success{background:#10b981}
.btn-success:hover{background:#059669}
.btn-danger{background:#ef4444}
.btn-danger:hover{background:#dc2626}
.card{background:#1a1f3a;border:1px solid rgba(148,163,184,0.2);border-radius:12px;padding:24px;margin-bottom:20px}
.card h2{color:#3b82f6;margin-bottom:16px;font-size:1.2rem}
.form-group{margin-bottom:16px}
.form-group label{display:block;color:#94a3b8;font-size:0.85rem;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px}
.form-group input{width:100%;padding:10px 14px;background:#0f172a;border:1px solid rgba(148,163,184,0.2);border-radius:8px;color:#e2e8f0;font-size:0.95rem}
.form-group input:focus{outline:none;border-color:#3b82f6}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.user-list{margin-top:16px}
.user-item{background:#0f172a;padding:12px 16px;border-radius:8px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
.user-item .info{flex:1;min-width:200px}
.user-item .name{font-weight:600;color:#e2e8f0}
.user-item .meta{font-size:0.8rem;color:#94a3b8;margin-top:4px}
.user-item .actions{display:flex;gap:8px;flex-wrap:wrap}
.user-item button{padding:6px 12px;font-size:0.8rem}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px}
.stat-card{background:#1a1f3a;padding:20px;border-radius:12px;text-align:center}
.stat-card .number{font-size:2rem;font-weight:700;color:#3b82f6;margin-bottom:4px}
.stat-card .label{color:#94a3b8;font-size:0.85rem}
.alert{padding:12px 16px;border-radius:8px;margin-bottom:16px}
.alert-success{background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);color:#6ee7b7}
.alert-danger{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:#fca5a5}
.toast{position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:16px 24px;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.3);display:none;z-index:1000;animation:slideIn 0.3s}
@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}
.loading{text-align:center;color:#94a3b8;padding:40px}
.firebase-status{text-align:center;padding:12px;background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.3);border-radius:8px;margin-bottom:16px;color:#3b82f6;font-size:0.9rem}
@media(max-width:768px){
.grid{grid-template-columns:1fr}
.user-item{flex-direction:column;align-items:flex-start}
.user-item .actions{width:100%}
.user-item button{flex:1}
}
</style>
</head>
<body>

<div class="container">
<div class="header">
<h1>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
<button class="btn" onclick="window.location.href='app.html'">üìö –ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</button>
</div>

<div class="firebase-status" id="firebaseStatus">üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase...</div>

<div id="message"></div>

<div class="stats">
<div class="stat-card">
<div class="number" id="totalUsers">-</div>
<div class="label">–í—Å–µ–≥–æ —É—á–µ–Ω–∏–∫–æ–≤</div>
</div>
<div class="stat-card">
<div class="number" id="activeUsers">-</div>
<div class="label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
</div>
<div class="stat-card">
<div class="number" id="blockedUsers">-</div>
<div class="label">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</div>
</div>
</div>

<div class="card">
<h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</h2>
<div class="grid">
<div class="form-group">
<label>–õ–æ–≥–∏–Ω</label>
<input type="text" id="newLogin" placeholder="student001">
</div>
<div class="form-group">
<label>–ü–∞—Ä–æ–ª—å</label>
<input type="text" id="newPassword" placeholder="–ü–∞—Ä–æ–ª—å –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω">
</div>
</div>
<div class="form-group">
<label>–§–ò–û —É—á–µ–Ω–∏–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
<input type="text" id="newName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
</div>
<button class="btn btn-success" id="addBtn" onclick="addStudent()" disabled>‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
<button class="btn" id="genBtn" onclick="generateCredentials()" disabled>üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å</button>
</div>

<div class="card">
<h2>üë• –°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤</h2>
<div class="user-list" id="userList">
<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>
</div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
import{getDatabase,ref,get,set,remove}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

const firebaseConfig={
apiKey:"AIzaSyBLCjON8ap7Mi0OKL1WYfKhIUuRPNgXEqQ",
authDomain:"advokat-kg.firebaseapp.com",
databaseURL:"https://advokat-kg-default-rtdb.firebaseio.com",
projectId:"advokat-kg",
storageBucket:"advokat-kg.firebasestorage.app",
messagingSenderId:"142941867206",
appId:"1:142941867206:web:f46e90d1c5b4c8ea6e0f0d"
};

try{
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
window.db=db;
window.dbRef=ref;
window.dbGet=get;
window.dbSet=set;
window.dbRemove=remove;
window.firebaseReady=true;

document.getElementById('firebaseStatus').innerHTML='‚úÖ Firebase –ø–æ–¥–∫–ª—é—á—ë–Ω';
document.getElementById('firebaseStatus').style.background='rgba(16,185,129,0.1)';
document.getElementById('firebaseStatus').style.borderColor='rgba(16,185,129,0.3)';
document.getElementById('firebaseStatus').style.color='#10b981';

document.getElementById('addBtn').disabled=false;
document.getElementById('genBtn').disabled=false;

loadUsers();
setTimeout(generateCredentials,500);
}catch(e){
console.error('Firebase init error:',e);
document.getElementById('firebaseStatus').innerHTML='‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase';
document.getElementById('firebaseStatus').style.background='rgba(239,68,68,0.1)';
document.getElementById('firebaseStatus').style.borderColor='rgba(239,68,68,0.3)';
document.getElementById('firebaseStatus').style.color='#ef4444';
}
</script>

<script>
const user=sessionStorage.getItem('user');
if(user!=='admin'){
alert('‚õî –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω');
window.location.href='index.html';
}

function showToast(msg){
const t=document.getElementById('toast');
t.textContent=msg;
t.style.display='block';
setTimeout(()=>t.style.display='none',3000);
}

async function loadUsers(){
if(!window.firebaseReady){
document.getElementById('userList').innerHTML='<p style="color:#ef4444;text-align:center;padding:20px">Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω</p>';
return;
}

try{
const usersRef=window.dbRef(window.db,'users');
const snapshot=await window.dbGet(usersRef);

const list=document.getElementById('userList');

if(!snapshot.exists()){
list.innerHTML='<p style="color:#94a3b8;text-align:center;padding:20px">–£—á–µ–Ω–∏–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
document.getElementById('totalUsers').textContent='0';
document.getElementById('activeUsers').textContent='0';
document.getElementById('blockedUsers').textContent='0';
return;
}

const users=snapshot.val();
const userList=Object.keys(users).filter(u=>u!=='admin');
const blocked=userList.filter(u=>users[u].blocked).length;

document.getElementById('totalUsers').textContent=userList.length;
document.getElementById('activeUsers').textContent=userList.length-blocked;
document.getElementById('blockedUsers').textContent=blocked;

if(userList.length===0){
list.innerHTML='<p style="color:#94a3b8;text-align:center;padding:20px">–£—á–µ–Ω–∏–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
return;
}

list.innerHTML=userList.map(u=>{
const userData=users[u];
return `
<div class="user-item">
<div class="info">
<div class="name">${userData.name||u} ${userData.blocked?'üö´':''}</div>
<div class="meta">
–õ–æ–≥–∏–Ω: <strong>${u}</strong> | –ü–∞—Ä–æ–ª—å: <strong>${userData.password}</strong>
${userData.device?' | üîí –ü—Ä–∏–≤—è–∑–∞–Ω':' | üîì –°–≤–æ–±–æ–¥–µ–Ω'}
</div>
</div>
<div class="actions">
<button class="btn" onclick="copyCredentials('${u}','${userData.password}','${userData.name||''}')">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
${userData.device?`<button class="btn" onclick="resetDevice('${u}')">üîì –°–±—Ä–æ—Å–∏—Ç—å</button>`:''}
${userData.blocked?
`<button class="btn btn-success" onclick="unblockUser('${u}')">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>`:
`<button class="btn btn-danger" onclick="blockUser('${u}')">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>`
}
<button class="btn btn-danger" onclick="deleteUser('${u}')">üóëÔ∏è</button>
</div>
</div>
`;
}).join('');

}catch(e){
console.error('Load error:',e);
document.getElementById('userList').innerHTML='<p style="color:#ef4444;text-align:center;padding:20px">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.</p>';
}
}

function generateCredentials(){
const num=Math.floor(Math.random()*900)+100;
const login='student'+String(num).padStart(3,'0');
const password=generatePassword();
document.getElementById('newLogin').value=login;
document.getElementById('newPassword').value=password;
}

function generatePassword(){
const words=['ADV','LAW','KR','EXZ'];
const word=words[Math.floor(Math.random()*words.length)];
const num=Math.floor(Math.random()*900)+100;
const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
const code=Array.from({length:3},()=>chars[Math.floor(Math.random()*chars.length)]).join('');
return word+num+code;
}

async function addStudent(){
if(!window.firebaseReady){
showMessage('‚ùå Firebase –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω','danger');
return;
}

const btn=document.getElementById('addBtn');
const login=document.getElementById('newLogin').value.toLowerCase().trim();
const password=document.getElementById('newPassword').value.trim();
const name=document.getElementById('newName').value.trim();

if(!login||!password){
showMessage('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å','danger');
return;
}

btn.disabled=true;

try{
const userRef=window.dbRef(window.db,'users/'+login);
const snapshot=await window.dbGet(userRef);

if(snapshot.exists()){
showMessage('‚ùå –õ–æ–≥–∏–Ω —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è','danger');
btn.disabled=false;
return;
}

await window.dbSet(userRef,{
password:password,
name:name||'',
device:null,
blocked:false,
created:new Date().toISOString()
});

showMessage(`‚úÖ –£—á–µ–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω! –õ–æ–≥–∏–Ω: ${login}`,'success');
document.getElementById('newLogin').value='';
document.getElementById('newPassword').value='';
document.getElementById('newName').value='';
generateCredentials();
loadUsers();

}catch(e){
console.error('Add error:',e);
showMessage('‚ùå –û—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.','danger');
}finally{
btn.disabled=false;
}
}

function copyCredentials(login,password,name){
const text=`üéì –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é "–ê–¥–≤–æ–∫–∞—Ç –ö–†"

${name?`üë§ –§–ò–û: ${name}\n`:''}üë§ –õ–æ–≥–∏–Ω: ${login}
üîë –ü–∞—Ä–æ–ª—å: ${password}

üåê –°—Å—ã–ª–∫–∞: https://ntral.github.io/advokat-kg/

‚ö†Ô∏è –í–ê–ñ–ù–û:
‚Ä¢ –û–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
‚Ä¢ –ü–µ—Ä–µ–¥–∞—á–∞ –¥–æ—Å—Ç—É–ø–∞ –¥—Ä—É–≥–∏–º –ª–∏—Ü–∞–º –∑–∞–ø—Ä–µ—â–µ–Ω–∞
‚Ä¢ –ü—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –±–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤

üìñ –ü—Ä–∏ –≤—Ö–æ–¥–µ –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π`;

const textarea=document.createElement('textarea');
textarea.value=text;
textarea.style.position='fixed';
textarea.style.opacity='0';
document.body.appendChild(textarea);
textarea.select();
textarea.setSelectionRange(0,99999);
try{
document.execCommand('copy');
showToast('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã! –û—Ç–ø—Ä–∞–≤—å—Ç–µ —É—á–µ–Ω–∏–∫—É');
}catch(e){
if(navigator.clipboard){
navigator.clipboard.writeText(text).then(()=>{
showToast('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã! –û—Ç–ø—Ä–∞–≤—å—Ç–µ —É—á–µ–Ω–∏–∫—É');
}).catch(()=>{
prompt('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é:',text);
});
}else{
prompt('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é:',text);
}
}
document.body.removeChild(textarea);
}

async function resetDevice(login){
if(!confirm(`–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è ${login}?`))return;
try{
const deviceRef=window.dbRef(window.db,'users/'+login+'/device');
await window.dbSet(deviceRef,null);
showMessage(`‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è ${login} —Å–±—Ä–æ—à–µ–Ω–æ`,'success');
loadUsers();
}catch(e){
showMessage('‚ùå –û—à–∏–±–∫–∞','danger');
}
}

async function blockUser(login){
if(!confirm(`–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ${login}?`))return;
try{
const blockedRef=window.dbRef(window.db,'users/'+login+'/blocked');
await window.dbSet(blockedRef,true);
showMessage(`üö´ ${login} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`,'success');
loadUsers();
}catch(e){
showMessage('‚ùå –û—à–∏–±–∫–∞','danger');
}
}

async function unblockUser(login){
try{
const blockedRef=window.dbRef(window.db,'users/'+login+'/blocked');
await window.dbSet(blockedRef,false);
showMessage(`‚úÖ ${login} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`,'success');
loadUsers();
}catch(e){
showMessage('‚ùå –û—à–∏–±–∫–∞','danger');
}
}

async function deleteUser(login){
if(!confirm(`–£–¥–∞–ª–∏—Ç—å ${login}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!`))return;
try{
const userRef=window.dbRef(window.db,'users/'+login);
await window.dbRemove(userRef);
showMessage(`üóëÔ∏è ${login} —É–¥–∞–ª—ë–Ω`,'success');
loadUsers();
}catch(e){
showMessage('‚ùå –û—à–∏–±–∫–∞','danger');
}
}

function showMessage(text,type){
const msg=document.getElementById('message');
msg.innerHTML=`<div class="alert alert-${type}">${text}</div>`;
setTimeout(()=>msg.innerHTML='',5000);
}
</script>
</body>
</html>
