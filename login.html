<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–í—Ö–æ–¥ ‚Äî –ê–¥–≤–æ–∫–∞—Ç –ö–†</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Mulish:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Mulish',sans-serif;background:linear-gradient(135deg,#0a0e27 0%,#1a1f3a 100%);color:#e2e8f0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{max-width:450px;width:100%}
.logo{width:100px;height:100px;margin:0 auto 24px;background:linear-gradient(135deg,#f59e0b,#d97706);border-radius:25px;display:flex;align-items:center;justify-content:center;font-size:48px;box-shadow:0 10px 40px rgba(245,158,11,0.3)}
h1{font-family:'Playfair Display',serif;font-size:2rem;color:#f59e0b;margin-bottom:8px;text-align:center}
.subtitle{text-align:center;color:#94a3b8;margin-bottom:40px;font-size:0.9rem}
.card{background:rgba(26,31,58,0.8);border:1px solid rgba(148,163,184,0.2);border-radius:20px;padding:40px;box-shadow:0 10px 40px rgba(0,0,0,0.3)}
.form-group{margin-bottom:24px}
label{display:block;color:#cbd5e1;margin-bottom:8px;font-weight:600;font-size:0.9rem}
input{width:100%;padding:14px 16px;background:rgba(15,23,42,0.6);border:2px solid rgba(148,163,184,0.2);border-radius:12px;color:#e2e8f0;font-size:1rem;transition:all 0.2s;font-family:'Mulish',sans-serif}
input:focus{outline:none;border-color:#3b82f6;background:rgba(15,23,42,0.8)}
input::placeholder{color:#64748b}
.btn{width:100%;padding:16px;background:linear-gradient(135deg,#3b82f6,#2563eb);border:none;border-radius:12px;color:white;font-weight:700;font-size:1.1rem;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 20px rgba(59,130,246,0.4);margin-top:8px}
.btn:hover{transform:translateY(-2px);box-shadow:0 6px 30px rgba(59,130,246,0.5)}
.btn:active{transform:translateY(0)}
.btn:disabled{opacity:0.6;cursor:not-allowed}
.btn-secondary{background:transparent;border:2px solid rgba(148,163,184,0.3);color:#cbd5e1;box-shadow:none;margin-top:12px}
.btn-secondary:hover{border-color:#3b82f6;background:rgba(59,130,246,0.1);box-shadow:none}
.error{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);padding:12px 16px;border-radius:8px;color:#fca5a5;font-size:0.9rem;margin-bottom:20px;display:none}
.error.show{display:block}
.success{background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);padding:12px 16px;border-radius:8px;color:#6ee7b7;font-size:0.9rem;margin-bottom:20px;display:none}
.success.show{display:block}
.divider{text-align:center;color:#64748b;margin:24px 0;position:relative}
.divider:before,.divider:after{content:'';position:absolute;top:50%;width:40%;height:1px;background:rgba(148,163,184,0.2)}
.divider:before{left:0}
.divider:after{right:0}
.links{text-align:center;margin-top:24px;font-size:0.9rem}
.links a{color:#3b82f6;text-decoration:none;font-weight:600}
.links a:hover{text-decoration:underline}
.loading{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(10,14,39,0.9);display:none;align-items:center;justify-content:center;z-index:1000}
.loading.show{display:flex}
.spinner{width:50px;height:50px;border:4px solid rgba(59,130,246,0.3);border-top-color:#3b82f6;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:768px){
.card{padding:30px 24px}
h1{font-size:1.75rem}
}
</style>
</head>
<body>

<div class="loading" id="loading">
<div class="spinner"></div>
</div>

<div class="container">
<div class="logo">‚öñÔ∏è</div>
<h1>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
<p class="subtitle">–ê–¥–≤–æ–∫–∞—Ç –ö–† ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω—É</p>

<div class="card">
<div class="error" id="error"></div>
<div class="success" id="success"></div>

<form onsubmit="handleLogin(event)" id="loginForm">
<div class="form-group">
<label for="username">üë§ –õ–æ–≥–∏–Ω</label>
<input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ª–æ–≥–∏–Ω" required autocomplete="username">
</div>

<div class="form-group">
<label for="password">üîí –ü–∞—Ä–æ–ª—å</label>
<input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å" required autocomplete="current-password">
</div>

<button type="submit" class="btn" id="loginBtn">üöÄ –í–æ–π—Ç–∏</button>
</form>

<div class="divider">–∏–ª–∏</div>

<button class="btn btn-secondary" onclick="tryDemo()">üéì –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ-–≤–µ—Ä—Å–∏—é</button>

<div class="links">
<a href="index.html">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>
</div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyBQD4IERaH6lW-TKs03giyUy9IL2UbT5OQ",
  authDomain: "advokat-kg.firebaseapp.com",
  projectId: "advokat-kg",
  storageBucket: "advokat-kg.firebasestorage.app",
  messagingSenderId: "13056866047",
  appId: "1:13056866047:web:6ac7b7a7eb4f3c5326beca"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
async function initializeAdmin(){
try{
const adminDoc = await db.collection('users').doc('admin').get();
if(!adminDoc.exists){
await db.collection('users').doc('admin').set({
password: 'admin2024',
role: 'admin',
name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
created: new Date().toISOString()
});
console.log('‚úÖ –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞–Ω');
}
}catch(e){
console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', e);
}
}

initializeAdmin();

function showLoading(show){
document.getElementById('loading').classList.toggle('show', show);
document.getElementById('loginBtn').disabled = show;
}

function showError(msg){
const el = document.getElementById('error');
el.textContent = msg;
el.classList.add('show');
document.getElementById('success').classList.remove('show');
setTimeout(() => el.classList.remove('show'), 5000);
}

function showSuccess(msg){
const el = document.getElementById('success');
el.textContent = msg;
el.classList.add('show');
document.getElementById('error').classList.remove('show');
}

function tryDemo(){
sessionStorage.setItem('user', 'demo');
// –õ–æ–≥–∏—Ä—É–µ–º –≤ Firebase
db.collection('logs').add({
username: 'demo',
event: 'login_success',
details: '–î–µ–º–æ-–¥–æ—Å—Ç—É–ø',
timestamp: new Date().toISOString(),
userAgent: navigator.userAgent
}).catch(e => console.error('–õ–æ–≥ –æ—à–∏–±–∫–∞:', e));

window.location.href = 'app-with-demo.html';
}

async function handleLogin(event){
event.preventDefault();
const username = document.getElementById('username').value.trim();
const password = document.getElementById('password').value;

if(!username || !password){
showError('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
return;
}

// –î–µ–º–æ –¥–æ—Å—Ç—É–ø
if(username === 'demo'){
tryDemo();
return;
}

showLoading(true);

try {
// –ß–∏—Ç–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Firebase
const userDoc = await db.collection('users').doc(username).get();

if(!userDoc.exists){
showError('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
// –õ–æ–≥–∏—Ä—É–µ–º –Ω–µ—É–¥–∞—á–Ω—É—é –ø–æ–ø—ã—Ç–∫—É
await db.collection('logs').add({
username,
event: 'login_failed',
details: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
timestamp: new Date().toISOString(),
userAgent: navigator.userAgent
});
showLoading(false);
return;
}

const user = userDoc.data();

if(user.password !== password){
showError('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
// –õ–æ–≥–∏—Ä—É–µ–º –Ω–µ—É–¥–∞—á–Ω—É—é –ø–æ–ø—ã—Ç–∫—É
await db.collection('logs').add({
username,
event: 'login_failed',
details: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
timestamp: new Date().toISOString(),
userAgent: navigator.userAgent
});
showLoading(false);
return;
}

// –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ - –ª–æ–≥–∏—Ä—É–µ–º
await db.collection('logs').add({
username,
event: 'login_success',
details: '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω',
timestamp: new Date().toISOString(),
userAgent: navigator.userAgent,
deviceType: navigator.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop'
});

// –û–±–Ω–æ–≤–ª—è–µ–º lastLogin
await db.collection('users').doc(username).update({
lastLogin: new Date().toISOString(),
lastDevice: navigator.userAgent.includes('Mobile') ? '–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ' : '–ö–æ–º–ø—å—é—Ç–µ—Ä'
});

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ session
sessionStorage.setItem('user', username);
sessionStorage.setItem('userRole', user.role);
sessionStorage.setItem('userName', user.name);

showSuccess('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...');

// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
setTimeout(() => {
if(user.role === 'admin'){
window.location.href = 'admin.html';
} else {
window.location.href = 'app-with-demo.html';
}
}, 1000);

} catch(error) {
console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
showError('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.');
showLoading(false);
}
}

// –°–∫—Ä—ã—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ
document.getElementById('username').addEventListener('input', () => {
document.getElementById('error').classList.remove('show');
});
document.getElementById('password').addEventListener('input', () => {
document.getElementById('error').classList.remove('show');
});
</script>

</body>
</html>
